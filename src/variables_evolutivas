require( "data.table" )

setwd("~/buckets/b1/datasets") # Establezco el Working Directory

dataset <- fread("competencia_02.csv.gz")

setwd("~/buckets/b1/expw/CN-0001")

impo_1 <- fread("impo_1.txt")

variables_importantes <- impo_1[1:20, "Feature	Gain"] #Selecciono las 20 variables mas importantes

#ACA HAY QUE EMPEZAR UN MEGA BUCLE
for (k in 1:20) {
#AQUI COMIENZO A CREAR NUEVAS VARIABLES-----------------------------------------

# Inicializa nuevas_variables como un data.table vacío
nuevas_variables <- data.table()

# Bucle para crear nuevas variables y agregar al dataset
l=1
for (i in 1:length(variables_importantes)) {
  for (j in i:length(variables_importantes)) {
    # Multiplica las columnas
    nueva_variable <- dataset[[variables_importantes[i]]] * dataset[[variables_importantes[j]]]
    
    # Crea el nombre de la nueva columna
    colname <- paste0("iter_",k,"_var_",l)
    l=l+1
#    colname <- paste0(variables_importantes[i], "_x_", variables_importantes[j])
    
    # Agrega la nueva variable al dataset original
    dataset[, (colname) := nueva_variable]
    
    # Agrega al diccionario nuevas_variables
    nuevas_variables <- rbind(nuevas_variables, data.table(nombre = colname,
                                                           explicacion = paste0(variables_importantes[i], "_x_", variables_importantes[j])))

#ESTAS LINEAS QUIZÁS LAS BORRE    
#    nuevas_variables <- rbind(nuevas_variables, data.table(original_var1 = variables_importantes[i], 
#                                                           original_var2 = variables_importantes[j], 
#                                                           new_variable_name = colname,))
  }
}

for (i in 1:length(variables_importantes)) {
  for (j in 1:length(variables_importantes)) {
    # Multiplica las columnas
    nueva_variable <- dataset[[variables_importantes[i]]] / dataset[[variables_importantes[j]]]
    
    # Crea el nombre de la nueva columna
    colname <- paste0("iter_",k,"_var_",l)
    l=l+1
#    colname <- paste0(variables_importantes[i], "_x_", variables_importantes[j])
    
    # Agrega la nueva variable al dataset original
    dataset[, (colname) := nueva_variable]
    
    # Agrega al diccionario nuevas_variables
    nuevas_variables <- rbind(nuevas_variables, data.table(nombre = colname,
                                                           explicacion = paste0(variables_importantes[i], "_/_", variables_importantes[j])))

#ESTAS LINEAS QUIZÁS LAS BORRE    
#    nuevas_variables <- rbind(nuevas_variables, data.table(original_var1 = variables_importantes[i], 
#                                                           original_var2 = variables_importantes[j], 
#                                                           new_variable_name = colname,))
  }
}

for (i in 1:length(variables_importantes)) {
  for (j in i:length(variables_importantes)) {
    # Multiplica las columnas
    nueva_variable <- dataset[[variables_importantes[i]]] + dataset[[variables_importantes[j]]]
    
    # Crea el nombre de la nueva columna
    colname <- paste0("iter_",k,"_var_",l)
    l=l+1
#    colname <- paste0(variables_importantes[i], "_+_", variables_importantes[j])
    
    # Agrega la nueva variable al dataset original
    dataset[, (colname) := nueva_variable]
    
    # Agrega al diccionario nuevas_variables
    nuevas_variables <- rbind(nuevas_variables, data.table(nombre = colname,
                                                           explicacion = paste0(variables_importantes[i], "_+_", variables_importantes[j])))

#ESTAS LINEAS QUIZÁS LAS BORRE    
#    nuevas_variables <- rbind(nuevas_variables, data.table(original_var1 = variables_importantes[i], 
#                                                           original_var2 = variables_importantes[j], 
#                                                           new_variable_name = colname,))
  }
}

setwd("~/buckets/b1/datasets")

# grabo las variables
cat( "escritura de variables nuevas\n")
cat( "Iniciando grabado de variables nuevas\n" )
# Crea el nombre del archivo usando la iteración k
nombre_archivo <- paste0("nuevas_variables_iter_", k, ".csv")

# Guarda el archivo
fwrite(nuevas_variables, file = nombre_archivo, logical01 = TRUE, sep = ",")
cat( "Finalizado grabado de nuevas variables\n" )





}
